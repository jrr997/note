# 小程序相关

## 登录逻辑

1. 短信登录步骤

   - 输入手机号、验证码 ->  提交登录参数到登录接口

   ```javascript
   {"loginType":1,"captcha":"201813","mobile":"13533616222","password":"201813","xcxJsCode":"011C9pll2mK6B745kInl
   ```

   - 验证成功:后端返回token、和登录人信息
   - 前端保存token和登录人信息到本地存储

2. 检查是否已登录

   - 在本地存储中查询用户信息，有则已登录

   ```javascript
   chekObj.isLogin() // 返回布尔值
   ```

3. 登出

   - 清除本地存储中的用户信息 -> 切到首页

   ```javascript
   checkObj.exitOut() 
   ```

4. 微信登录

   - 用户调用`wx.login()`获取js_code,把其发送到服务端
   - 服务端调用`auto_code2session()`向微信接口服务获取用户openid和unionid
   - 如果获取成功表示登录成功，服务端可以返回自定义的登录信息到客户端
   - 客户端把自定义登录信息保存到本地存储
   - 客户端的登录信息和用户唯一标识unionid一一对应



## 坑：APPID

小程序开发时需要把APPID改为正确的APPID(在小程序后台可看到)。有一种现象是，3个人开发同一个小程序，APPID都是不同的。在用一些需要权限的功能时(获取手机号码、登录),大家的表现都不同。比如获取手机号时没有授权弹窗，或者直接弹出APPID错误，或者可以获取到手机号，不过登录时因为与后端的APPID不同导致获取不了openid。
